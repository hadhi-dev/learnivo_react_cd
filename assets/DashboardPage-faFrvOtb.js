import{h as e}from"./vendor-ui-D-W4xDah.js";import{C as P}from"./Card-DaSwpW43.js";import{S as g,P as G}from"./StatCard-C54p3PhX.js";import{L as q}from"./index-9Ntr3LAE.js";import{h as Q,j as V,a as l}from"./vendor-react-pOJj_1mY.js";import{S as W,y as A}from"./vendor-alerts-CMxmQAUU.js";import{c as E}from"./config-BbshSSl6.js";import{d as K,g as X}from"./ApiService-VEMuM_mw.js";import{G as Z}from"./GetAPI-C0R9K2iB.js";import{E as ee,h as T,O as te,Q as se,b as z,J as $,L as re,m,B as ae,Y as f,c as ne}from"./vendor-other-BEndW8qv.js";import"./vendor-forms-CxLqLCH9.js";import"./vendor-recharts-pV3kltCe.js";const ye=()=>{const h=Q(),[y,oe]=V(),[n,L]=l.useState(null),[ie,R]=l.useState([]),[N,B]=l.useState([]),[C,p]=l.useState([]),[U,v]=l.useState(!1),[w,b]=l.useState(null),M=JSON.parse(localStorage.getItem("udt")),x=localStorage.getItem("usid"),I=localStorage.getItem("uid"),j=l.useRef(null);l.useEffect(()=>{y.get("uuid")&&h("/home?pg=dashboard",{replace:!0})},[h,y]);const F=(t,s)=>{const r=new Date(t),a=new Date,o=s*60*60*1e3;return a-r>=o},H=(t,s)=>{if(!t||!s)return console.warn("Invalid date or hours:",{dateTime:t,hours:s}),null;try{const r=new Date(t),a=new Date;if(isNaN(r.getTime()))return console.warn("Invalid date format:",t),null;const o=parseInt(s);if(isNaN(o)||o<=0)return console.warn("Invalid course hours:",s),null;const c=o*60*60*1e3,u=a-r,d=c-u;if(d<=0)return null;const i=Math.floor(d/(1e3*60*60)),k=Math.floor(d%(1e3*60*60)/(1e3*60)),S=Math.floor(d%(1e3*60)/1e3);return{hours:i,minutes:k,seconds:S,formatted:`${i}h ${k}m ${S}s`}}catch(r){return console.error("Error calculating remaining time:",r),null}},_=(t,s,r)=>s?{bg:"bg-green-100",text:"text-green-700",label:"Certified"}:t?{bg:"bg-blue-100",text:"text-blue-700",label:"In Progress"}:r?{bg:"bg-amber-100",text:"text-amber-700",label:"Payment Pending"}:{bg:"bg-gray-100",text:"text-gray-700",label:"Not Started"},D=async()=>{v(!0),b(null);try{const t=await K(x);(t==null?void 0:t.code)===200?(L(t.data.analytics),R(t.data.tasks)):b("Failed to fetch dashboard analytics")}catch{b("Failed to fetch dashboard analytics")}finally{v(!1)}},O=async()=>{try{const t=await X(x);B(t.data||[])}catch(t){console.error("Failed to fetch courses",t)}},Y=async()=>{try{const t=await Z(`newcourse/${I}`);(t==null?void 0:t.code)===200&&t.data?p(t.data):p([])}catch(t){console.error("Failed to fetch new courses",t),p([])}},J=async t=>{if((await W.fire({title:"Enroll in Course",text:"Do you want to enroll in this course? You will be redirected to the payment page.",icon:"question",showCancelButton:!0,confirmButtonText:"Proceed to Payment",cancelButtonText:"Cancel",confirmButtonColor:"#4f46e5",cancelButtonColor:"#6b7280"})).isConfirmed)try{A.info("Redirecting to payment page...",{position:"top-right",autoClose:2e3});const r=`${E.API_URL}enroll/${t}/${x}`,a=document.createElement("a");a.href=r,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(r){console.error("Error processing enrollment:",r),A.error("Error processing enrollment. Please try again.",{position:"top-right",autoClose:3e3})}};return l.useEffect(()=>{D(),O(),Y()},[x,I]),w?e.jsx("div",{className:"p-6 text-red-500",children:w}):e.jsxs("div",{style:{position:"relative"},children:[U&&e.jsx(q,{position:"absolute"}),e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("h1",{className:"mb-6 text-3xl font-bold text-gray-900",children:["Hello, ",M.username,"!"]}),e.jsxs("button",{onClick:D,className:"flex items-center gap-2 rounded-md border border-gray-300 px-3 py-1 text-sm text-gray-600 hover:bg-gray-100",children:[e.jsx(ee,{size:16})," Refresh"]})]}),e.jsxs("div",{className:"mb-8 grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsx(g,{title:"Total Courses",value:(n==null?void 0:n.totalCourses)??0,icon:e.jsx(T,{})}),e.jsx(g,{title:"Active Courses",value:(n==null?void 0:n.activeCourses)??0,icon:e.jsx(te,{}),color:"yellow"}),e.jsx(g,{title:"Tasks Due",value:(n==null?void 0:n.tasksDue)??0,icon:e.jsx(se,{}),color:"red"}),e.jsx(g,{title:"Certificates",value:(n==null?void 0:n.certifiedCourses)??0,icon:e.jsx(z,{}),color:"green"})]}),e.jsx("h2",{className:"mb-4 text-2xl font-bold text-gray-900",children:"My Courses"}),e.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:N.length>0?N.map((t,s)=>{const r=_(t.IsPaid,t.IsCertified,t.IsPaymentUnderProcess),a=parseInt(t.CourseCode)||0,o=t.created_datetime||t.CreatedDate||t.CreatedAt||t.created_at;s===0&&console.log("Course data sample:",{CourseName:t.CourseName,CourseCode:t.CourseCode,courseHours:a,dateField:o,IsCertified:t.IsCertified});const c=F(o,a),u=c?null:H(o,a);return t.IsCertified,e.jsxs(P,{className:"flex flex-col",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t.CourseName}),e.jsx("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${r.bg} ${r.text}`,children:r.label})]}),e.jsx("p",{className:"mb-4 line-clamp-2 text-sm text-gray-600",children:t.ShortDescription}),t.IsPaid&&e.jsx(G,{progress:t.completedPercentage||0}),e.jsxs("div",{className:"mt-4 mb-4 flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:[t.CompletedTask||0," of ",t.TotalTask||0," tasks completed"]}),e.jsx("span",{className:"font-medium text-gray-600",children:t.InstructorName})]}),e.jsx("div",{className:"mt-auto flex flex-col gap-2",children:t.IsCertified?c?e.jsxs("button",{onClick:()=>{const d=`${E.API_URL}certificate/${t.UUID||t.id}`,i=document.createElement("a");i.href=d,i.target="_blank",i.rel="noopener noreferrer",document.body.appendChild(i),i.click(),document.body.removeChild(i)},className:"flex items-center justify-center gap-2 rounded-lg bg-green-600 px-3 py-2 text-xs font-semibold text-white transition-all hover:bg-green-700",children:[e.jsx($,{size:14}),"Download Certificate"]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{disabled:!0,className:"flex cursor-not-allowed items-center justify-center gap-2 rounded-lg bg-gray-300 px-3 py-2 text-xs font-semibold text-gray-600",title:"Certificate available after course duration",children:[e.jsx(re,{size:14}),"Certificate Locked"]}),u&&e.jsxs("div",{className:"rounded-lg border border-blue-200 bg-blue-50 p-2 text-center",children:[e.jsx("p",{className:"text-xs font-semibold text-blue-700",children:"Available in:"}),e.jsx("p",{className:"text-xs text-blue-600",children:u.formatted})]})]}):t.IsPaid?e.jsxs("button",{onClick:()=>h(`/home?pg=courseDetail&uuid=${t.UUID}`),className:"flex items-center justify-center gap-2 rounded-lg bg-indigo-600 px-3 py-2 text-xs font-semibold text-white transition-all hover:bg-indigo-700",children:[e.jsx($,{size:14}),"Open Course"]}):e.jsx("button",{disabled:!0,className:"flex cursor-not-allowed items-center justify-center gap-2 rounded-lg bg-amber-300 px-3 py-2 text-xs font-semibold text-amber-800",children:"Payment Pending"})})]},s)}):e.jsx(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"lg:col-span-3 md:col-span-2 col-span-1",children:e.jsxs("div",{className:"rounded-2xl border-2 border-dashed border-indigo-200 bg-gradient-to-br from-indigo-50 via-purple-50 to-white p-12 text-center",children:[e.jsx("div",{className:"mb-6 flex justify-center",children:e.jsx(m.div,{animate:{y:[0,-10,0]},transition:{duration:3,repeat:1/0},className:"inline-block",children:e.jsx(ae,{size:80,className:"text-indigo-400",strokeWidth:1})})}),e.jsx("h3",{className:"mb-3 text-2xl font-bold text-gray-800",children:"No Courses Joined Yet"}),e.jsx("p",{className:"mb-6 text-lg text-gray-600",children:"You haven't joined any courses yet. Start your learning journey by exploring our available courses!"}),e.jsxs("div",{className:"mb-8 flex justify-center gap-4",children:[e.jsx(m.div,{animate:{scale:[1,1.2,1]},transition:{duration:2,repeat:1/0,delay:0},className:"rounded-full bg-indigo-100 p-3",children:e.jsx(T,{size:24,className:"text-indigo-600"})}),e.jsx(m.div,{animate:{scale:[1,1.2,1]},transition:{duration:2,repeat:1/0,delay:.3},className:"rounded-full bg-purple-100 p-3",children:e.jsx(f,{size:24,className:"text-purple-600"})}),e.jsx(m.div,{animate:{scale:[1,1.2,1]},transition:{duration:2,repeat:1/0,delay:.6},className:"rounded-full bg-pink-100 p-3",children:e.jsx(z,{size:24,className:"text-pink-600"})})]}),e.jsxs(m.button,{whileHover:{scale:1.05,boxShadow:"0 10px 25px rgba(79, 70, 229, 0.3)"},whileTap:{scale:.95},onClick:()=>{var t;(t=j.current)==null||t.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{var s;(s=j.current)==null||s.classList.add("highlight-pulse")},500)},className:"inline-flex items-center gap-2 rounded-lg bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-3 font-semibold text-white shadow-lg transition-all hover:from-indigo-700 hover:to-purple-700",children:[e.jsx(f,{size:18}),"Explore Courses",e.jsx(ne,{size:18})]}),e.jsx("p",{className:"mt-6 text-sm text-gray-500",children:'ðŸ’¡ Tip: Check out "New Courses Available" section below to get started!'})]})})}),C.length>0&&e.jsxs("div",{className:"mt-12",ref:j,children:[e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx(f,{size:24,className:"text-amber-500"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"New Courses Available"})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:C.map((t,s)=>e.jsxs(P,{className:"border-2 border-amber-200 bg-gradient-to-br from-amber-50 to-white",children:[e.jsxs("div",{className:"mb-3 inline-flex items-center gap-2 rounded-full bg-amber-100 px-3 py-1 text-xs font-semibold text-amber-700",children:[e.jsx(f,{size:12}),"New"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t.CourseName}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Code: ",t.CourseCode]})]}),e.jsx("p",{className:"mb-4 line-clamp-2 text-sm text-gray-600",children:t.ShortDescription}),e.jsxs("div",{className:"mb-4 space-y-2 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Department:"}),e.jsx("span",{className:"font-medium text-gray-800",children:t.Department})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Instructor:"}),e.jsx("span",{className:"font-medium text-gray-800",children:t.InstructorName})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Price:"}),e.jsxs("span",{className:"font-bold text-indigo-600",children:["â‚¹ ",t.Amount]})]})]}),e.jsx("button",{onClick:()=>J(t.CourseID||t.id),className:"w-full rounded-lg bg-gradient-to-r from-amber-500 to-orange-500 px-4 py-2 font-semibold text-white transition-all hover:scale-105 hover:shadow-lg",children:"Enroll Now"})]},s))})]})]})};export{ye as default};
