import{h as t}from"./vendor-ui-D-W4xDah.js";import{C as I}from"./Card-DaSwpW43.js";import{S as u,P as H}from"./StatCard-C54p3PhX.js";import{L as O}from"./index-D15ZWCma.js";import{h as G,j as q,a as i}from"./vendor-react-pOJj_1mY.js";import{S as J,y as D}from"./vendor-alerts-CMxmQAUU.js";import{c as P}from"./config-BbshSSl6.js";import{d as K,g as Y}from"./ApiService-VEMuM_mw.js";import{G as Q}from"./GetAPI-C0R9K2iB.js";import{y as V,h as W,K as X,N as Z,b as ee,z as S,L as te,O as k}from"./vendor-other-a5iLNtiF.js";import"./vendor-forms-CxLqLCH9.js";import"./vendor-recharts-g12deziw.js";const he=()=>{const g=G(),[b,se]=q(),[o,A]=i.useState(null),[re,E]=i.useState([]),[$,L]=i.useState([]),[p,f]=i.useState([]),[T,j]=i.useState(!1),[y,h]=i.useState(null),U=JSON.parse(localStorage.getItem("udt")),m=localStorage.getItem("usid"),C=localStorage.getItem("uid");i.useEffect(()=>{b.get("uuid")&&g("/home?pg=dashboard",{replace:!0})},[g,b]);const M=(e,r)=>{const s=new Date(e),a=new Date,n=r*60*60*1e3;return a-s>=n},R=(e,r)=>{if(!e||!r)return console.warn("Invalid date or hours:",{dateTime:e,hours:r}),null;try{const s=new Date(e),a=new Date;if(isNaN(s.getTime()))return console.warn("Invalid date format:",e),null;const n=parseInt(r);if(isNaN(n)||n<=0)return console.warn("Invalid course hours:",r),null;const c=n*60*60*1e3,x=a-s,d=c-x;if(d<=0)return null;const l=Math.floor(d/(1e3*60*60)),w=Math.floor(d%(1e3*60*60)/(1e3*60)),v=Math.floor(d%(1e3*60)/1e3);return{hours:l,minutes:w,seconds:v,formatted:`${l}h ${w}m ${v}s`}}catch(s){return console.error("Error calculating remaining time:",s),null}},z=(e,r,s)=>r?{bg:"bg-green-100",text:"text-green-700",label:"Certified"}:e?{bg:"bg-blue-100",text:"text-blue-700",label:"In Progress"}:s?{bg:"bg-amber-100",text:"text-amber-700",label:"Payment Pending"}:{bg:"bg-gray-100",text:"text-gray-700",label:"Not Started"},N=async()=>{j(!0),h(null);try{const e=await K(m);(e==null?void 0:e.code)===200?(A(e.data.analytics),E(e.data.tasks)):h("Failed to fetch dashboard analytics")}catch{h("Failed to fetch dashboard analytics")}finally{j(!1)}},B=async()=>{try{const e=await Y(m);L(e.data||[])}catch(e){console.error("Failed to fetch courses",e)}},F=async()=>{try{const e=await Q(`newcourse/${C}`);(e==null?void 0:e.code)===200&&e.data?f(e.data):f([])}catch(e){console.error("Failed to fetch new courses",e),f([])}},_=async e=>{if((await J.fire({title:"Enroll in Course",text:"Do you want to enroll in this course? You will be redirected to the payment page.",icon:"question",showCancelButton:!0,confirmButtonText:"Proceed to Payment",cancelButtonText:"Cancel",confirmButtonColor:"#4f46e5",cancelButtonColor:"#6b7280"})).isConfirmed)try{D.info("Redirecting to payment page...",{position:"top-right",autoClose:2e3});const s=`${P.API_URL}enroll/${e}/${m}`,a=document.createElement("a");a.href=s,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(s){console.error("Error processing enrollment:",s),D.error("Error processing enrollment. Please try again.",{position:"top-right",autoClose:3e3})}};return i.useEffect(()=>{N(),B(),F()},[m,C]),y?t.jsx("div",{className:"p-6 text-red-500",children:y}):t.jsxs("div",{style:{position:"relative"},children:[T&&t.jsx(O,{position:"absolute"}),t.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[t.jsxs("h1",{className:"mb-6 text-3xl font-bold text-gray-900",children:["Hello, ",U.username,"!"]}),t.jsxs("button",{onClick:N,className:"flex items-center gap-2 rounded-md border border-gray-300 px-3 py-1 text-sm text-gray-600 hover:bg-gray-100",children:[t.jsx(V,{size:16})," Refresh"]})]}),t.jsxs("div",{className:"mb-8 grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4",children:[t.jsx(u,{title:"Total Courses",value:(o==null?void 0:o.totalCourses)??0,icon:t.jsx(W,{})}),t.jsx(u,{title:"Active Courses",value:(o==null?void 0:o.activeCourses)??0,icon:t.jsx(X,{}),color:"yellow"}),t.jsx(u,{title:"Tasks Due",value:(o==null?void 0:o.tasksDue)??0,icon:t.jsx(Z,{}),color:"red"}),t.jsx(u,{title:"Certificates",value:(o==null?void 0:o.certifiedCourses)??0,icon:t.jsx(ee,{}),color:"green"})]}),t.jsx("h2",{className:"mb-4 text-2xl font-bold text-gray-900",children:"My Courses"}),t.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:$.map((e,r)=>{const s=z(e.IsPaid,e.IsCertified,e.IsPaymentUnderProcess),a=parseInt(e.CourseCode)||0,n=e.created_datetime||e.CreatedDate||e.CreatedAt||e.created_at;r===0&&console.log("Course data sample:",{CourseName:e.CourseName,CourseCode:e.CourseCode,courseHours:a,dateField:n,IsCertified:e.IsCertified});const c=M(n,a),x=c?null:R(n,a);return e.IsCertified,t.jsxs(I,{className:"flex flex-col",children:[t.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:e.CourseName}),t.jsx("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${s.bg} ${s.text}`,children:s.label})]}),t.jsx("p",{className:"mb-4 line-clamp-2 text-sm text-gray-600",children:e.ShortDescription}),e.IsPaid&&t.jsx(H,{progress:e.completedPercentage||0}),t.jsxs("div",{className:"mt-4 mb-4 flex items-center justify-between text-xs text-gray-500",children:[t.jsxs("span",{children:[e.CompletedTask||0," of ",e.TotalTask||0," tasks completed"]}),t.jsx("span",{className:"font-medium text-gray-600",children:e.InstructorName})]}),t.jsx("div",{className:"mt-auto flex flex-col gap-2",children:e.IsCertified?c?t.jsxs("button",{onClick:()=>{const d=`${P.API_URL}certificate/${e.UUID||e.id}`,l=document.createElement("a");l.href=d,l.target="_blank",l.rel="noopener noreferrer",document.body.appendChild(l),l.click(),document.body.removeChild(l)},className:"flex items-center justify-center gap-2 rounded-lg bg-green-600 px-3 py-2 text-xs font-semibold text-white transition-all hover:bg-green-700",children:[t.jsx(S,{size:14}),"Download Certificate"]}):t.jsxs(t.Fragment,{children:[t.jsxs("button",{disabled:!0,className:"flex cursor-not-allowed items-center justify-center gap-2 rounded-lg bg-gray-300 px-3 py-2 text-xs font-semibold text-gray-600",title:"Certificate available after course duration",children:[t.jsx(te,{size:14}),"Certificate Locked"]}),x&&t.jsxs("div",{className:"rounded-lg border border-blue-200 bg-blue-50 p-2 text-center",children:[t.jsx("p",{className:"text-xs font-semibold text-blue-700",children:"Available in:"}),t.jsx("p",{className:"text-xs text-blue-600",children:x.formatted})]})]}):e.IsPaid?t.jsxs("button",{onClick:()=>g(`/home?pg=courseDetail&uuid=${e.UUID}`),className:"flex items-center justify-center gap-2 rounded-lg bg-indigo-600 px-3 py-2 text-xs font-semibold text-white transition-all hover:bg-indigo-700",children:[t.jsx(S,{size:14}),"Open Course"]}):t.jsx("button",{disabled:!0,className:"flex cursor-not-allowed items-center justify-center gap-2 rounded-lg bg-amber-300 px-3 py-2 text-xs font-semibold text-amber-800",children:"Payment Pending"})})]},r)})}),p.length>0&&t.jsxs("div",{className:"mt-12",children:[t.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[t.jsx(k,{size:24,className:"text-amber-500"}),t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"New Courses Available"})]}),t.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:p.map((e,r)=>t.jsxs(I,{className:"border-2 border-amber-200 bg-gradient-to-br from-amber-50 to-white",children:[t.jsxs("div",{className:"mb-3 inline-flex items-center gap-2 rounded-full bg-amber-100 px-3 py-1 text-xs font-semibold text-amber-700",children:[t.jsx(k,{size:12}),"New"]}),t.jsxs("div",{className:"mb-2",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:e.CourseName}),t.jsxs("p",{className:"text-xs text-gray-500",children:["Code: ",e.CourseCode]})]}),t.jsx("p",{className:"mb-4 line-clamp-2 text-sm text-gray-600",children:e.ShortDescription}),t.jsxs("div",{className:"mb-4 space-y-2 text-sm text-gray-600",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{children:"Department:"}),t.jsx("span",{className:"font-medium text-gray-800",children:e.Department})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{children:"Instructor:"}),t.jsx("span",{className:"font-medium text-gray-800",children:e.InstructorName})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{children:"Price:"}),t.jsxs("span",{className:"font-bold text-indigo-600",children:["â‚¹ ",e.Amount]})]})]}),t.jsx("button",{onClick:()=>_(e.CourseID||e.id),className:"w-full rounded-lg bg-gradient-to-r from-amber-500 to-orange-500 px-4 py-2 font-semibold text-white transition-all hover:scale-105 hover:shadow-lg",children:"Enroll Now"})]},r))})]})]})};export{he as default};
